var ImageStream = require('./image-stream');
var concat = require('concat-frames');

var createImages = function createImages(images, id) {
  return concat(function imageFromFrames(frames) {
    var data = frames[0];
    var width = data.width;
    var height = data.height;

    for (var variation in images) {
      var imageStream = ImageStream({
        id: id,
        name: id + '--' + variation,
        type: variation,
        width: width,
        height: height
      });

      images[variation](imageStream);

      imageStream.emit('format', {
        width: width,
        height: height,
        colorSpace: data.colorSpace
      });
      imageStream.end(data.pixels);
    }
  });
};


module.exports = createImages;
